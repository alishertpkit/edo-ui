<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Связи</title>
<style>
body{font-family:Arial;margin:20px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
.row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
input,button{padding:6px}
small{color:#666}
</style>
</head>
<script src="/include.js"></script>
<body>
<h2>Связи документов</h2>
<small>Требуется X-User-Id с правом doc.link. Впиши user_id (обычно 1).</small>

<div class="row">
  <input id="uid" placeholder="X-User-Id" style="width:110px" value="1">
  <input id="from" placeholder="from_doc" style="width:110px">
  <input id="to" placeholder="to_doc" style="width:110px">
  <input id="type" placeholder="link_type" style="width:160px" value="execution_of">
  <button onclick="create()">Создать</button>
</div>

<pre id="msg"></pre>

<table>
<thead><tr><th>ID</th><th>from</th><th>to</th><th>type</th></tr></thead>
<tbody id="rows"></tbody>
</table>

<script>
async function load(){
  const r = await fetch('/api/links');
  const data = await r.json();
  document.getElementById('rows').innerHTML = data.map(x=>`
    <tr><td>${x.id}</td><td>${x.from_doc}</td><td>${x.to_doc}</td><td>${x.link_type}</td></tr>
  `).join('');
}
async function create(){
  const uid = document.getElementById('uid').value||'';
  const from_doc = Number(document.getElementById('from').value||0);
  const to_doc = Number(document.getElementById('to').value||0);
  const link_type = document.getElementById('type').value||'execution_of';
  const r = await fetch('/api/links',{
    method:'POST',
    headers:{'Content-Type':'application/json','X-User-Id':uid},
    body:JSON.stringify({from_doc,to_doc,link_type})
  });
  const t = await r.text();
  document.getElementById('msg').textContent = t;
  load();
}
load();
</script>
</body>
</html>
